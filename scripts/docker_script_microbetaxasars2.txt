FROM ubuntu:18.04
MAINTAINER Olaitan I. Awe laitanawe@gmail.com

ENV MY_DOCKER_DIRECTORY=/packages
ENV SRA_TOOLKIT=/usr/local/ncbi/sra-tools/bin

## microbetaxasars2:21.04
## Update apt database
RUN apt-get update -y

## Install FastQC: Quality Control
RUN apt-get install -y \
   fastqc \
## Install Prodigal: Annotation of Assembled Genomes and install python
   prodigal \
   python3.8 \
   python3-distutils \
   curl

# Create symbolic link for Python 3.8, it works well with the pipeline
# You can cd into your preferred package directory before downloading installers
RUN ln -s /usr/bin/python3.8 /usr/bin/python && mkdir -pv ${MY_DOCKER_DIRECTORY} && cd ${MY_DOCKER_DIRECTORY} && echo "The setup is making progress. FastQC, Prodigal, Python and Curl have been installed!" > ${MY_DOCKER_DIRECTORY}/install_microbetaxasars2.log
WORKDIR ${MY_DOCKER_DIRECTORY}

## Install SPADES: Genome Assembly (MetaSPAdes)
RUN curl -# -SLO http://cab.spbu.ru/files/release3.12.0/SPAdes-3.12.0-Linux.tar.gz \
   && tar zxvf SPAdes-3.12.0-Linux.tar.gz
## Environment Path variable should be updated this way, as an alternative to export
ENV PATH "$PATH:${MY_DOCKER_DIRECTORY}/SPAdes-3.12.0-Linux/bin"

## Install NCBI SRA Toolkit: Set of tools and libraries for using Sequence Read Archive data
RUN curl -# -SLO https://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/2.11.0/setup-apt.sh
RUN chmod +x ${MY_DOCKER_DIRECTORY}/setup-apt.sh
RUN ${MY_DOCKER_DIRECTORY}/setup-apt.sh
## SRA Toolkit must be configured with the following command before using it
RUN vdb-config --interactive
## Remove files that are no more needed.
#RUN rm -v setup-apt.sh SPAdes-3.12.0-Linux.tar.gz

# Add SRA-Toolkit to Environment Variable
ENV PATH "$PATH:${SRA_TOOLKIT}"

## These are just comments that can be ignored or removed:
## E.g: If you have a list of accessions, create fastq dir, you can test if SRA Toolkit works multithread 16cores:
## cat wgs_data/accession_list.txt | xargs fasterq-dump --outdir fastq -e 16
#cp -v /home/laitanawe/packages/*.py /packages
